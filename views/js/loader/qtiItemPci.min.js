define("tpl!qtiItemPci/pciManager/tpl/layout",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div class=\"pcimgr resourcemgr\">\n\n    <section class=\"file-selector\">\n        <h1>\n            <div class=\"title-container lft\">\n                <span class=\"title\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Manage custom interactions",{name:"__",hash:{},data:data,loc:{start:{line:6,column:36},end:{line:6,column:71}}}))+"</span>\n            </div>\n            <div class=\"upload-switcher rgt\">\n                <a href=\"#\" class=\"btn-info small upload\"><span class=\"icon-add\"></span>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Add Interaction",{name:"__",hash:{},data:data,loc:{start:{line:9,column:88},end:{line:9,column:112}}}))+"</a>\n                <a href=\"#\" class=\"btn-info small listing hidden\"><span class=\"icon-undo\"></span>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Back to listing",{name:"__",hash:{},data:data,loc:{start:{line:10,column:97},end:{line:10,column:121}}}))+"</a>\n            </div>\n        </h1>\n\n        <div class=\"empty\">\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"No Custom Interaction",{name:"__",hash:{},data:data,loc:{start:{line:15,column:12},end:{line:15,column:42}}}))+"\n        </div>\n\n        <ul class=\"files\"></ul>\n\n        <div class=\"file-upload-container hidden\"></div>\n    </section>\n\n</div>"},useData:!0})}),define("tpl!qtiItemPci/pciManager/tpl/listing",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var stack1,helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<li data-type-identifier=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"typeIdentifier")||(null==depth0?depth0:lookupProperty(depth0,"typeIdentifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"typeIdentifier",hash:{},data:data,loc:{start:{line:5,column:26},end:{line:5,column:44}}}):helper))+"\" data-pci-identifier=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"pci_identifier")||(null==depth0?depth0:lookupProperty(depth0,"pci_identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"pci_identifier",hash:{},data:data,loc:{start:{line:5,column:67},end:{line:5,column:85}}}):helper))+"\" class=\"pci-list-element"+(null==(stack1=lookupProperty(helpers,"unless").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"enabled"),{name:"unless",hash:{},fn:container.program(2,data,0),inverse:container.noop,data:data,loc:{start:{line:5,column:110},end:{line:5,column:154}}}))?"":stack1)+"\">\n    <span class=\"desc truncate\">\n        <span class=\"name\">("+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"model")||(null==depth0?depth0:lookupProperty(depth0,"model")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"model",hash:{},data:data,loc:{start:{line:7,column:28},end:{line:7,column:37}}}):helper))+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"runtimeOnly"),{name:"if",hash:{},fn:container.program(4,data,0),inverse:container.noop,data:data,loc:{start:{line:7,column:37},end:{line:7,column:107}}}))?"":stack1)+") - "+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:7,column:111},end:{line:7,column:120}}}):helper))+" - v"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"version")||(null==depth0?depth0:lookupProperty(depth0,"version")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"version",hash:{},data:data,loc:{start:{line:7,column:124},end:{line:7,column:135}}}):helper))+"</span>\n        <span class=\"disable-tag\">- "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"disabled",{name:"__",hash:{},data:data,loc:{start:{line:8,column:36},end:{line:8,column:53}}}))+"</span>\n    </span>\n\n    <div class=\"actions\">\n        <div class=\"pci-switch\"></div>\n        <div class=\"pci-download-button\"></div>\n        <div class=\"pci-unregister-button\"></div>\n    </div>\n</li>\n"},2:function(container,depth0,helpers,partials,data){return" pci-disabled\""},4:function(container,depth0,helpers,partials,data){return" <span class=\"runtime\">- runtime only</span>"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div class=\"action-header\">\n        <span class=\"switch-header\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Enabled in item authoring",{name:"__",hash:{},data:data,loc:{start:{line:2,column:36},end:{line:2,column:70}}}))+"</span>\n    </div>\n"+(null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"interactions"),{name:"each",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:4,column:0},end:{line:17,column:9}}}))?"":stack1)},useData:!0})}),define("tpl!qtiItemPci/pciManager/tpl/packageMeta",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var helper,lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<span class=\"upload-label\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:1,column:27},end:{line:1,column:36}}}):helper))+"</span>\n<span class=\"upload-separator\"></span>\n<span class=\"upload-identifier\">("+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"type : ",{name:"__",hash:{},data:data,loc:{start:{line:3,column:33},end:{line:3,column:49}}}))+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"model")||(null==depth0?depth0:lookupProperty(depth0,"model")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"model",hash:{},data:data,loc:{start:{line:3,column:49},end:{line:3,column:58}}}):helper))+", "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"id : ",{name:"__",hash:{},data:data,loc:{start:{line:3,column:60},end:{line:3,column:74}}}))+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"typeIdentifier")||(null==depth0?depth0:lookupProperty(depth0,"typeIdentifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"typeIdentifier",hash:{},data:data,loc:{start:{line:3,column:74},end:{line:3,column:92}}}):helper))+", "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"version : ",{name:"__",hash:{},data:data,loc:{start:{line:3,column:94},end:{line:3,column:113}}}))+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"version")||(null==depth0?depth0:lookupProperty(depth0,"version")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"version",hash:{},data:data,loc:{start:{line:3,column:113},end:{line:3,column:124}}}):helper))+")</span>\n<span class=\"upload-separator\">-</span>"},useData:!0})}),define("qtiItemPci/pciManager/pciManager",["jquery","i18n","lodash","ui/component","ui/hider","ui/switch/switch","ui/button","tpl!qtiItemPci/pciManager/tpl/layout","tpl!qtiItemPci/pciManager/tpl/listing","tpl!qtiItemPci/pciManager/tpl/packageMeta","async","ui/dialog/confirm","ui/dialog","ui/feedback","ui/modal","ui/uploader","ui/filesender"],function($,__,_,component,hider,switchFactory,buttonFactory,layoutTpl,listingTpl,packageMetaTpl,asyncLib,confirmBox,dialog,feedback){"use strict";const _fileTypeFilters=["application/zip","application/x-zip-compressed","application/x-zip"],_fileExtFilter=/.+\.(zip)$/,_defaults={loadUrl:null,disableUrl:null,enableUrl:null,verifyUrl:null,addUrl:null},pciManager={open:function open(){this.trigger("showListing"),this.getElement().appendTo(".pci-manager")}};return function pciManagerFactory(config){let listing={};return component(pciManager,_defaults).setTemplate(layoutTpl).on("showListing",function(){const $fileSelector=this.getElement().find(".file-selector"),$title=$fileSelector.find(".title"),$uploader=$fileSelector.find(".file-upload-container"),$uploadForm=$uploader.parent("form"),$switcher=$fileSelector.find(".upload-switcher a");hider.show($switcher.filter(".upload")),hider.hide($switcher.filter(".listing")),$uploadForm.hide(),hider.hide($uploader),$title.text(__("Manage custom interactions")),this.trigger("updateListing")}).on("hideListing",function(){const $fileSelector=this.getElement().find(".file-selector"),$fileContainer=$fileSelector.find(".files"),$placeholder=$fileSelector.find(".empty"),$title=$fileSelector.find(".title"),$uploader=$fileSelector.find(".file-upload-container"),$uploadForm=$uploader.parent("form"),$switcher=$fileSelector.find(".upload-switcher a");hider.show($switcher.filter(".listing")),hider.hide($switcher.filter(".upload")),$switcher.filter(".listing").css({display:"inline-block"}),$uploadForm.show(),hider.hide($fileContainer),hider.hide($placeholder),$title.text(__("Upload new custom interaction (zip package)")),$uploader.uploader("reset"),hider.show($uploader)}).on("updateListing",function(){const self=this,urls=_.pick(this.config,["disableUrl","enableUrl","unregisterUrl","exportPciUrl"]),$fileSelector=this.getElement().find(".file-selector"),$fileContainer=$fileSelector.find(".files"),$placeholder=$fileSelector.find(".empty");_.size(listing)?(hider.hide($placeholder),$fileContainer.empty().html(listingTpl({interactions:listing})),$fileContainer.find(".actions").each(function(){const pciDownloadButton=$(this).find(".pci-download-button"),pciswitch=$(this).find(".pci-switch"),pciUnregisterButton=$(this).find(".pci-unregister-button"),$li=$(this).closest("li"),typeIdentifier=$li.data("typeIdentifier"),pciIdentifier=$li.data("pciIdentifier"),runtimeOnly=listing[typeIdentifier].runtimeOnly;runtimeOnly||switchFactory(pciswitch,{on:{active:!$li.hasClass("pci-disabled")},off:{active:$li.hasClass("pci-disabled")}}).on("on",function(){$li.removeClass("pci-disabled"),$.getJSON(urls.enableUrl,{typeIdentifier:typeIdentifier},function(data){data.success&&(listing[typeIdentifier].enabled=!0,self.trigger("pciEnabled",typeIdentifier))})}).on("off",function(){$li.addClass("pci-disabled"),$.getJSON(urls.disableUrl,{typeIdentifier:typeIdentifier},function(data){data.success&&(listing[typeIdentifier].enabled=!1,self.trigger("pciDisabled",typeIdentifier))})}),buttonFactory({id:"unregister",type:"info",icon:"bin",label:__("Delete"),class:"unregister",renderTo:pciUnregisterButton}).on("click",function confirmDialog(){dialog({class:"icon-warning",heading:__("Warning"),message:__("You are about to delete the Portable Custom Interaction <strong>%s</strong> from the system.",typeIdentifier),content:__("This action will affect all items that may be using it and cannot be undone. Please confirm your choice."),autoRender:!0,autoDestroy:!0,buttons:[{id:"cancel",type:"regular",label:__("Cancel"),close:!0},{id:"delete",type:"error",label:__("Delete"),close:!0}],onDeleteBtn:function onDeleteBtn(){$.getJSON(urls.unregisterUrl,{typeIdentifier:typeIdentifier},function(data){data.success&&(delete listing[typeIdentifier],self.trigger("pciDisabled",typeIdentifier))})}})}),runtimeOnly||buttonFactory({id:"exportPci",type:"info",icon:"import",label:__("Download"),renderTo:pciDownloadButton}).on("click",function(){window.location=`${urls.exportPciUrl}?typeIdentifier=${typeIdentifier}&pciIdentifier=${pciIdentifier}`})}),hider.show($fileContainer)):(hider.hide($fileContainer),hider.show($placeholder))}).on("pciEnabled",function(){this.trigger("updateListing")}).on("pciDisabled",function(){this.trigger("updateListing")}).on("render",function(){function initEventListeners(){$switcher.on("click",function(e){e.preventDefault(),hider.isHidden($uploader)?self.trigger("hideListing"):self.trigger("showListing")})}function initUploader(){function verify(file,cb){$uploadForm.sendfile({url:urls.verifyUrl,file:file,loaded:function(r){function done(ok){ok&&(selectedFiles[file.name]={typeIdentifier:r.typeIdentifier,label:r.label,version:r.version,model:r.model}),cb(ok)}r.valid?r.exists?confirmBox(__("There is already one interaction with the same identifier \"%s\" (label : \"%s\") and same version : %s. Do you want to override the existing one ?",r.typeIdentifier,r.label,r.version),function(){done(!0)},function(){done(!1)}):done(!0):(_.isArray(r.messages)&&_.forEach(r.messages,function(report){feedback().error(report.message)}),done(!1))},failed:function(message){cb(new Error(message))}})}let errors=[],selectedFiles={};$uploader.on("upload.uploader",function(e,file,interactionHook){listing[interactionHook.typeIdentifier]=interactionHook,self.trigger("pciAdded",interactionHook.typeIdentifier)}).on("fail.uploader",function(e,file,err){errors.push(__("Unable to upload file %s : %s",file.name,err))}).on("end.uploader",function(){0===errors.length?self.trigger("showListing"):feedback().error(`<ul><li>${errors.join("</li><li>")}</li></ul>`,{encodeHtml:!1}),errors=[]}).on("create.uploader",function(){$uploadForm=$uploader.parent("form"),$uploadForm.hide()}).on("fileselect.uploader",function(){$uploadForm.find("li[data-file-name]").each(function(){const $li=$(this),filename=$li.data("file-name"),packageMeta=selectedFiles[filename];packageMeta&&$li.prepend(packageMetaTpl(packageMeta))})}),$uploader.uploader({upload:!0,multiple:!0,uploadUrl:urls.addUrl,fileSelect:function fileSelect(files,done){const givenLength=files.length;files=_.filter(files,function(file){const checkType=file.type.replace(/("|')/g,"");return _.contains(_fileTypeFilters,checkType)||""===checkType&&_fileExtFilter.test(file.name)}),files.length!==givenLength&&feedback().error(__("Invalid files have been removed")),selectedFiles={},asyncLib.filter(files,verify,done)}})}const self=this,urls=_.pick(this.config,["loadUrl","disableUrl","enableUrl","verifyUrl","addUrl"]),$container=this.getElement(),$fileSelector=$container.find(".file-selector"),$uploader=$fileSelector.find(".file-upload-container"),$switcher=$fileSelector.find(".upload-switcher a");let $uploadForm;initEventListeners(),initUploader(),$.getJSON(urls.loadUrl,function(data){listing=_.size(data)?data:{},self.trigger("updateListing",data),self.trigger("loaded",data)})}).init(config)}}),define("css!qtiItemPciCss/pci-manager",[],function(){}),define("qtiItemPci/controller/pciManager/index",["jquery","util/url","qtiItemPci/pciManager/pciManager","css!qtiItemPciCss/pci-manager"],function($,url,pciManager){"use strict";var $container=$(".pci-manager");return{start:function start(){pciManager({renderTo:$container,loadUrl:url.route("getRegisteredImplementations","PciManager","qtiItemPci"),disableUrl:url.route("disable","PciManager","qtiItemPci"),enableUrl:url.route("enable","PciManager","qtiItemPci"),verifyUrl:url.route("verify","PciManager","qtiItemPci"),addUrl:url.route("add","PciManager","qtiItemPci"),unregisterUrl:url.route("unregister","PciManager","qtiItemPci"),exportPciUrl:url.route("export","PciManager","qtiItemPci")})}}}),define("qtiItemPci/controller/routes",[],function(){"use strict";return{PciManager:{actions:{index:"controller/pciManager/index"}}}}),function(c){var d=document,a="appendChild",i="styleSheet",s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0].appendChild(s),s.styleSheet?s.styleSheet.cssText=c:s.appendChild(d.createTextNode(c))}(".pci-manager{margin:auto auto;width:80%}.pci-manager .pcimgr{max-width:100%}.pci-manager .resourcemgr{width:100%}.pci-manager-trigger:before{margin-right:5px;font-size:10.5px;font-size:1.05rem;font-family:\"tao\" !important;speak:never;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:\"\uE61C\"}.pcimgr .file-selector{display:block;min-height:400px;min-width:100%;margin-bottom:20px}.pcimgr .file-selector .title-container{margin-right:75px}.pcimgr .file-selector .title-container .title{margin-right:0}.pcimgr .file-selector .note{color:#0e5d91;font-weight:bold;margin:0 3px}.pcimgr .file-selector .note-container{position:absolute;bottom:-30px}.pcimgr .file-selector ul.files{overflow-y:auto;min-height:300px}.pcimgr .file-selector ul.files div.action-header{position:relative;height:2rem}.pcimgr .file-selector ul.files div.action-header span.switch-header{position:absolute}.pcimgr .file-selector .pci-list-element{cursor:default !important}.pcimgr .file-selector .pci-list-element span.runtime{color:#0e5d91}.pcimgr .file-selector .pci-list-element div.actions{top:5px !important;width:auto !important;height:auto !important;line-height:1.4}.pcimgr .file-selector .pci-list-element div.actions .pci-switch{margin-right:2rem;position:relative;left:0;top:1px;display:inline}.pcimgr .file-selector .pci-list-element div.actions .pci-unregister-button{position:relative;display:inline;margin-right:2rem}.pcimgr .file-selector .pci-list-element div.actions .pci-download-button{position:relative;display:inline}.pcimgr .file-selector .pci-list-element .button-disable{height:18px;padding:4px 6px;display:inline-block}.pcimgr .file-selector .pci-list-element .button-enable{height:18px;padding:4px 6px;display:none}.pcimgr .file-selector .pci-list-element .disable-tag{display:none;font-style:italic}.pcimgr .file-selector .pci-list-element.pci-disabled{color:#a7a7a7}.pcimgr .file-selector .pci-list-element.pci-disabled:hover{background:#ecf2f6}.pcimgr .file-selector .pci-list-element.pci-disabled .button-disable{display:none}.pcimgr .file-selector .pci-list-element.pci-disabled .button-enable{display:inline-block}.pcimgr .file-selector .pci-list-element.pci-disabled .desc{font-style:italic}.pcimgr .file-selector .pci-list-element.pci-disabled .disable-tag{display:inline-block}.pcimgr .file-selector .file-upload-container{display:block}.uploader .upload-separator{margin:0 2px;color:#333}.uploader .upload-label{font-weight:bold}.uploader .upload-identifier{color:#333}\n\n/*# sourceMappingURL=qtiItemPciCss/pci-manager.css.map */"),define("qtiItemPci/loader/qtiItemPci.bundle",function(){}),define("qtiItemPci/loader/qtiItemPci.min",["taoItems/loader/taoItems.min","taoQtiItem/loader/taoQtiItem.min"],function(){});
//# sourceMappingURL=qtiItemPci.min.js.map